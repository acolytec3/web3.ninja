{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/dao_notifications","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://unsplash.com/photos/v0OWc_skg0g\">Photo by Parker Johnson on Unsplash</a></p>\n<h2>Motivations</h2>\n<p> I recently joined a DAO (decentralized autonomous organization) that's based on the <a href=\"https://aragon.net\">Aragon platform</a>. This type of DAO is a set of interlocking smart contracts tht allow for on-chain voting, minting/burning of tokens when members join/leave the DAO, and disbursement of DAO funds to Ethereum addresses when votes pass successfully.  The DAO I'm a part of uses Discord for our discussions and team member activities and we don't currently have an easy way to track when votes are created, who votes which way, etc.  You can give your email address to Aragon and it will provide you with notifications when events happen but I wanted a clean way to have notifications delivered directly to our Discord server without having to have some DAO member manually posting each time something happens.  In other words, I want the <a href=\"https://github.com/acolytec3/ArgoDisco\">ArgoDisco Bot</a>.  So, let's get to work.</p>\n<h3>Caveats</h3>\n<p>I'm going to assume you already know your way around Etherscan and how to read a contract ABI, as well as a working knowledge of Javascript and Web3 related stuff.  </p>\n<h2>The Goal</h2>\n<p> Conceptually, what I want to build here isn't hard.  I just want a bot that will read events emitted by certain smart contracts and then post those notifications in a Discord channel.  The question is, how to connect alll that up.  Aragon does offer a <a href=\"https://github.com/aragon/aragon.js\">Javascript library</a> and it probably offers this functionality somewhere but I couldn't be bothered trying to figure it all out.  I'm just going to use Subspace, because, well, it's about 10 lines of code and we're ready to go.</p>\n<h2>The Backend</h2>\n<p> First, let's decide what events we want ArgoDisco to report on. Aragon DAOs are set up as a collection of smart contracts, one for voting, one for moving funds, and one for managing the membership tokens (there are more but these are the ones we'll use).  And, from these four smart contracts, we want ArgoDisco to notify the DAO whenever a new vote is created, someone votes, when funds are disbursed, or when a member joins/leaves.  So, we need to set up 4 observables, one tracking each event.  I just need to initiate Subspace, create the contract object, subscribe to the events based on how they're defined in the contract ABI, and away we go, right?  Should be as simple as below.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">    <span class=\"token keyword\">const</span> web3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Web3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wss://mainnet.infura.io/ws/v3/\"</span> <span class=\"token operator\">+</span> config<span class=\"token punctuation\">.</span>infuraToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> subspace <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subspace<span class=\"token punctuation\">.</span>default</span><span class=\"token punctuation\">(</span>web3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> subspace<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    votingContract <span class=\"token operator\">=</span> subspace<span class=\"token punctuation\">.</span><span class=\"token function\">contract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>abi<span class=\"token operator\">:</span> votingABI<span class=\"token punctuation\">,</span> address<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>votingAddress<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> startVote$ <span class=\"token operator\">=</span> votingContract<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span>StartVote<span class=\"token punctuation\">.</span><span class=\"token function\">track</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>fromBlock<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>lastBlock<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//...more code to post stuff to Discord</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>And it is, but there's one gotcha, so let's step through setting up the Observable for the <code class=\"language-text\">StartVote</code> event.</p>\n<p>Let's look at the contract ABI and find the <code class=\"language-text\">StartVote</code> event.  First thing I did was go to my DAO's page on Aragon, click on the Organization link, and see the Apps listed.  Clicking on the \"Voting\" app gives me the Ethereum address of the voting contract and then over to Etherscan to get the ABI.  The problem I quickly discovered is...the only event I see on the contract is this one.<br>\n<code class=\"language-text\">[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;sender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;ProxyDeposit&quot;,&quot;type&quot;:&quot;event&quot;}]</code>\nLooking at the contract events in Etherscan seems to confirm that these events line up with votes being created and cast by the DAO but the event names are meaningless.  The clue is the word \"proxy\" in the contract.  Aragon uses proxy contracts to ensure upgradeability and my DAO's contracts are no different.  Thankfully, there's an easy way to resolve this.  Each proxy contract points to am implementation contract and Etherscan has built in support for tracking this.  If you don't already see the <code class=\"language-text\">Read as Proxy</code> link under the list of contract options on Etherscan, click on the \"More Options\" link, and then click on \"Is this a proxy?\" <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 346px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7a309f3596b904d5d2f7bc98308f7ed/8f77f/proxy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz41RTUvDQBDtv/bioYhgFUVRqSDWj2LUFltLwVihFbF4URA/8OCxlKYqNk2yye7sJrtx0mpMixUfj2EY5s28nU2Fo1BK+UGAlEoh/W8MCkpGiCLmFHgqKcN4dtFczO6ubmlruYNsTpueXUpnVmYWVqfSmbnlDa2k7xWq8+vbl9e3UoXj4pu7x2L1/ERvlE8bFb2+ox3nj8r7xcpmvnBYqur1K2ShUrt/fkEvqZ7NYn5YFN2FE4BmbU8QGjAIvmw7LotpOV4gJXHdntk3+5ZlOxiJ7dTMzoNrhoHs2YR40O4YRrcr/CAlEgAAHAnAPYpzOZJhCfiroFYgQqnYoMEwOq1Wy0fbPAHGGNrDhcPNOG7UtsQGLJIILnAxKgbAjxC+jwnFPi7a4L378CMGEDzyxRgwEOObI9ucO4T0LRtf27TenqgV/UUsFsLzBvJfNks5+dp/ihF4niQpwPBmMRETxf9BLP4EiSug4M0dUDEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Is this a proxy link\"\n        title=\"Is this a proxy link\"\n        src=\"/static/d7a309f3596b904d5d2f7bc98308f7ed/8f77f/proxy.png\"\n        srcset=\"/static/d7a309f3596b904d5d2f7bc98308f7ed/fac75/proxy.png 125w,\n/static/d7a309f3596b904d5d2f7bc98308f7ed/63868/proxy.png 250w,\n/static/d7a309f3596b904d5d2f7bc98308f7ed/8f77f/proxy.png 346w\"\n        sizes=\"(max-width: 346px) 100vw, 346px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>  Etherscan will take you to a \"Proxy Contract Verification\" page where it will display the implementation contract that it believes your proxy contract is leveraging.  Click verify and hopefully it will pop up a modal saying it's successfully verified.</p>\n<p>Once done, go back to the main contract page and click the \"Read as Proxy\" link.  Then, you'll see a message appear saying \"ABI for the implementation contract at 0x1234...\"  Click that link and then grab the contract ABI from there.  That's where the events we're looking for are found.  Below is the exact event you're looking for.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"anonymous\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"inputs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"indexed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"voteId\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"uint256\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"indexed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"creator\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"address\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"indexed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"metadata\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"StartVote\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"event\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now that we have the right ABI, one more thing to remember, when you're setting up your contract object, use the contract address for your DAO's Voting contract and not the implementation contract where you found the ABI.  Confusing, right?</p>\n<h2>The Bot</h2>\n<p>Now, back to our bot. Let's walk through the important pieces.</p>\n<h3>Dependencies and setup</h3>\n<p>First, the boring stuff.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Web3 <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'web3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Subspace <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@embarklabs/subspace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">const</span> Discord <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'discord.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n<span class=\"token keyword\">const</span> votingABI <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./voting.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> tokensABI <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./tokens.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> financeABI <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./finance.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> config <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./bot_config.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> web3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Web3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wss://mainnet.infura.io/ws/v3/\"</span> <span class=\"token operator\">+</span> config<span class=\"token punctuation\">.</span>infuraToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> subspace <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subspace<span class=\"token punctuation\">.</span>default</span><span class=\"token punctuation\">(</span>web3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Discord<span class=\"token punctuation\">.</span>Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>First, dependencies - <a href=\"https://github.com/ethereum/web3.js\">Web3js</a>, <a href=\"https://subspace.embarklans.io\">Subspace</a>, and <a href=\"https://discord.js.org/#/\">Discord.js</a>.  This last one is the library we'll use to push messages to our Discord server.  Also, <code class=\"language-text\">fs</code> because we're going to be doing some simple file I/O later.\nNext, contract ABIs.  ArgoDisco reads events off three differenct contracts, so we have three contract ABIs, imported as JSON objects.\nLastly, I've got a config file setup that stores the API keys for my Discord Bot, my Infura API, contract addresses, and a list of Ethereum addresses and Discord nicknames for DAO members.  See <a href=\"https://github.com/acolytec3/ArgoDisco/blob/master/src/bot_config.json.example\">this example</a> for how to set it up.</p>\n<h3>Coming online</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">bot<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>botDiscordToken<span class=\"token punctuation\">)</span>\nbot<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ready'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Logged in as </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bot<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>tag<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> channel <span class=\"token operator\">=</span> bot<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">channel</span> <span class=\"token operator\">=></span> channel<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string\">'general'</span><span class=\"token punctuation\">)</span>\n    channel<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Howdy'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Once all the dependencies are squared away, let's connect up the bot to our Discord server, using the code above.  Note, there are a number of additional steps involved in getting the Discord bot account created, getting the Bot API key, inviting the bot to a server, that are beyond the scope of this article.  See <a href=\"https://discordjs.guide/preparations/setting-up-a-bot-application.html\">here</a> or <a href=\"https://www.devdungeon.com/content/javascript-discord-bot-tutorial\">here</a> for more specifics.  </p>\n<p>Basically it comes down to telling the bot to login using the APIKey and then I tell it to connect to the \"general\" channel and let everyone know it's there with a friendly \"Howdy\".  Then, pass the channel object to the function I've generically called <code class=\"language-text\">initialize</code> to get to the important bits.</p>\n<h3>Reporting the news</h3>\n<p>Now, our bot is online and ready to start notifying the DAO about what's happening on-chain. This is all there is to it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">    <span class=\"token keyword\">await</span> subspace<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    votingContract <span class=\"token operator\">=</span> subspace<span class=\"token punctuation\">.</span><span class=\"token function\">contract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>abi<span class=\"token operator\">:</span> votingABI<span class=\"token punctuation\">,</span> address<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>votingAddress<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> startVote$ <span class=\"token operator\">=</span> votingContract<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span>StartVote<span class=\"token punctuation\">.</span><span class=\"token function\">track</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>fromBlock<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>lastBlock<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    startVote$<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">vote</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">**Vote # </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>vote<span class=\"token punctuation\">[</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>vote<span class=\"token punctuation\">[</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">** https://mainnet.aragon.org/?#/arca/0x9b8e397c483449623525efda8f80d9b52481a3a1/vote/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>vote<span class=\"token punctuation\">[</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>vote<span class=\"token punctuation\">)</span>\n        config<span class=\"token punctuation\">.</span>lastBlock <span class=\"token operator\">=</span> vote<span class=\"token punctuation\">.</span>blockNumber<span class=\"token punctuation\">;</span>\n        fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src/bot_config.json'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Initiate Subspace, create the Subspace-enhanced <code class=\"language-text\">contract</code> object, and define the observable.  In this case, it's tracking the <code class=\"language-text\">StartVote</code> event on the <code class=\"language-text\">votingContract</code> we talked about earlier.</p>\n<p><strong>Note</strong>: When setting up the observable, I'm setting the <code class=\"language-text\">fromBlock</code> configuration option to the <code class=\"language-text\">lastBlock</code> value from my bot's configuration file.  Explanation below.</p>\n<p>Inside the subscription, the important bits are <code class=\"language-text\">channel.send()</code> which posts the notification to Discord, and then the <code class=\"language-text\">fs.writeFile...</code> bit that is recording the block number as events stream throguh the Observable back to the config file.  The reason I'm tracking block number here is that Subspace observables stream events from the beginning of Ethereum time (i.e. Block 0) unless you tell them otherwise.  So, if your bot ever crashes and gets restarted, the observable will also start over and begin streaming events from block 0 again.  Since we don't want the bot to report the same events over again, we always set the <code class=\"language-text\">fromBlock</code> in the observable's configuration options to <code class=\"language-text\">lastBlock</code> so that if the bot does restart, it picks up where the last event was reported.  </p>\n<p>Once the bot is up and running, you'll start seeing things like below in your Discord channel:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 332px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebdffd2dd98fbf5baab33a569d0bb7e1/f8dc5/vote_note.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQY01WNy0rDQBRA80EaK5mZJM080mQymSZTTWjSpqmxQYulutBVETfqShH0N8Q/EQRd9X+coAuFw+FeuIdr+Dy92tyqvHJxkBd1XswmVZOk2dHqab159WiMWYSZwL7oU45c9hdj3q4/vrY3d4/Q9Zv2rFksm8VpOZm1588X12/YlzSI6UCycKh76NB/8cnq8v1ze//wYiF8kE/HZR1EqZ4B6lvAQfpaYxPb6UC/0B8bwKYuk8BljjcIhdIlF4r4EWISUgG9EJAIUAForA0x7yCdAeGG/g5tAh3i4lAdlsPRWMhRonIrLnbVcU9O93lmJvO9pNbodSdb9mRpqsZMqm9MXFYaVTfA3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Discord notifications from ArgoDisco\"\n        title=\"Discord notifications from ArgoDisco\"\n        src=\"/static/ebdffd2dd98fbf5baab33a569d0bb7e1/f8dc5/vote_note.png\"\n        srcset=\"/static/ebdffd2dd98fbf5baab33a569d0bb7e1/fac75/vote_note.png 125w,\n/static/ebdffd2dd98fbf5baab33a569d0bb7e1/63868/vote_note.png 250w,\n/static/ebdffd2dd98fbf5baab33a569d0bb7e1/f8dc5/vote_note.png 332w\"\n        sizes=\"(max-width: 332px) 100vw, 332px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And that's it.  Once we get this up and running, the bot will faithfully report each new event for the contract events it's subscribed to.  As currently configured, the ArgoDisco bot will report when votes start, when someone casts a vote, when a new payment is made, and when a token is minted or burned for a DAO member.<br>\n<strong>Note</strong>: For the token mint/burn event, use the address of the ERC20 contract associated with your DAO and not the \"Tokens\" contract that your DAO's page on Aragon links to.\"  </p>\n<p>I hope this has been helpful and is a realworld example of how Subspace can help power your Web3 applications far beyond simple <a href=\"/blog/observing_defi\">Defi Dashboards</a>.</p>","excerpt":"Photo by Parker Johnson on Unsplash Motivations  I recently joined a DAO (decentralized autonomous organization) that's based on the Aragon platform. This typeâ€¦","frontmatter":{"date":"10 June, 2020","path":"/blog/dao_notifications","title":"DIY Aragon DAO Notifications - Powered by Subspace","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEBQH/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGhuYDrmQJxrZReSif/xAAeEAACAwABBQAAAAAAAAAAAAABAgADERAEEhMUIf/aAAgBAQABBQIdXje1VovrIXsaGtWnji14AM4b5C3H/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8BhT//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAABBAMBAAAAAAAAAAAAAAAAAQIhMSAyYZH/2gAIAQEABj8CVr08LNkO9ILJy//EABwQAAICAgMAAAAAAAAAAAAAAAABETEQIUFR8f/aAAgBAQABPyFMJNO6FQzpEm8NA0QNvA6Br4O0Tgc60Sf/2gAMAwEAAgADAAAAEBjEsP/EABcRAQEBAQAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8Q12CDJ//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EKQ//8QAHxABAAICAgIDAAAAAAAAAAAAAQARIUFRcTFhgaHh/9oACAEBAAE/EC1VWZUyOG7pqACB5aY/kq0KX53MGlwJeAABXjPbWdT9g9OMAShv7mBYmipBd9z/2Q==","aspectRatio":0.6666666666666666,"src":"/static/33cf037c040a21e48fb5208937f7b605/14b42/parker-johnson-v0OWc_skg0g-unsplash.jpg","srcSet":"/static/33cf037c040a21e48fb5208937f7b605/f836f/parker-johnson-v0OWc_skg0g-unsplash.jpg 200w,\n/static/33cf037c040a21e48fb5208937f7b605/2244e/parker-johnson-v0OWc_skg0g-unsplash.jpg 400w,\n/static/33cf037c040a21e48fb5208937f7b605/14b42/parker-johnson-v0OWc_skg0g-unsplash.jpg 800w,\n/static/33cf037c040a21e48fb5208937f7b605/47498/parker-johnson-v0OWc_skg0g-unsplash.jpg 1200w,\n/static/33cf037c040a21e48fb5208937f7b605/0e329/parker-johnson-v0OWc_skg0g-unsplash.jpg 1600w,\n/static/33cf037c040a21e48fb5208937f7b605/c61c3/parker-johnson-v0OWc_skg0g-unsplash.jpg 2807w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"fields":{"readingTime":{"text":"8 min read"}}}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"]}